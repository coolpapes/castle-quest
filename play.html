<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Castle Quest - Atari 800 XL Emulator</title>
<link rel="stylesheet" href="A8E/jsA8E/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
<style>
  #gameBar {
    background: #1a1a2e;
    color: #e0e0ff;
    padding: 10px 20px;
    font-family: monospace;
    font-size: 13px;
    border-bottom: 2px solid #444;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }
  #gameBar .title { color: #ffcc00; font-weight: bold; font-size: 15px; white-space: nowrap; }
  #gameBar .status { flex: 1; min-width: 200px; }
  #gameBar button {
    border: none;
    padding: 6px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-family: monospace;
    font-weight: bold;
    font-size: 13px;
  }
  #btnPlay {
    background: #2a5;
    color: #fff;
  }
  #btnPlay:hover:not(:disabled) { background: #3b6; }
  #btnPlay:disabled { background: #555; color: #888; cursor: not-allowed; }
  #btnAutoRun {
    background: #47a;
    color: #fff;
  }
  #btnAutoRun:hover:not(:disabled) { background: #58b; }
  #btnAutoRun:disabled { background: #555; color: #888; cursor: not-allowed; }
  .info-toggle {
    background: none !important;
    border: 1px solid #666 !important;
    color: #88ccff !important;
    padding: 4px 12px !important;
    font-size: 12px !important;
  }
  .info-toggle:hover { border-color: #88ccff !important; }
  #infoPanel {
    display: none;
    background: #111;
    padding: 16px 20px;
    font-family: monospace;
    font-size: 13px;
    color: #ccc;
    border-bottom: 1px solid #333;
    max-height: 400px;
    overflow-y: auto;
    line-height: 1.6;
  }
  #infoPanel.visible { display: block; }
  #infoPanel h3 { color: #ffcc00; margin: 12px 0 6px; }
  #infoPanel h3:first-child { margin-top: 0; }
  #infoPanel code { background: #333; padding: 2px 6px; border-radius: 3px; color: #ff8; }
  #infoPanel .note { color: #ff8888; }
  #infoPanel .ok { color: #88ff88; }
  #infoPanel ul, #infoPanel ol { padding-left: 20px; }
  #infoPanel li { margin-bottom: 4px; }
</style>
</head>
<body>

<!-- Game-specific bar -->
<div id="gameBar">
  <span class="title">CASTLE QUEST (1983)</span>
  <span class="status" id="gameStatus">Initializing...</span>
  <button id="btnPlay" disabled>Play Game</button>
  <button id="btnAutoRun" disabled>Type RUN</button>
  <button class="info-toggle" id="btnInfo">Info / Help</button>
</div>

<div id="infoPanel">
  <h3>How to Play</h3>
  <p>This page runs Castle Quest in a browser-based Atari 800 XL emulator (jsA8E)
     with built-in Altirra replacement ROMs. No setup required!</p>
  <ol>
    <li>Click <strong>Play Game</strong> &mdash; the Atari boots and loads the game into BASIC.</li>
    <li>Click <strong>Type RUN</strong> (or type <code>RUN</code> + RETURN yourself) to start the game.</li>
  </ol>
  <p style="color:#aaa; font-size:12px;">ROM replacement firmware:
     Altirra OS 3.11 &amp; Altirra BASIC 1.58 &copy; 2008-2022 Avery Lee.
     Distributed under permissive license (see source).</p>

  <h3>Game Controls</h3>
  <ul>
    <li><strong>Arrow Keys</strong> &mdash; Move (joystick)</li>
    <li><strong>Left Alt</strong> &mdash; Fire (activate magic cloak)</li>
    <li><strong>F4</strong> &mdash; START</li>
    <li><strong>F5</strong> &mdash; RESET</li>
  </ul>

  <h3>About</h3>
  <p>Castle Quest by Timothy G. Baldwin, published in <em>COMPUTE!'s Third Book of Atari</em> (1983).
     Rescue Princess Dilayna by navigating 30 rooms across 3 castles, avoiding deadly walls and
     enemy servants, and capturing the evil wizards.</p>
</div>

<!-- jsA8E Emulator UI -->
<header class="topbar">
  <div class="brand">
    <div class="titleRow">
      <span class="title">jsA8E</span>
    </div>
  </div>
  <div class="controls">
    <label class="fileBtn" title="Load ATARIXL.ROM">
      <input type="file" id="romOs" accept=".rom,application/octet-stream" />
      <span>ATARIXL.ROM <i id="romOsStatus" class="fa-solid fa-circle-xmark status-icon"></i></span>
    </label>
    <label class="fileBtn" title="Load ATARIBAS.ROM">
      <input type="file" id="romBasic" accept=".rom,application/octet-stream" />
      <span>ATARIBAS.ROM <i id="romBasicStatus" class="fa-solid fa-circle-xmark status-icon"></i></span>
    </label>
    <label class="fileBtn" title="Load ATR disk image">
      <input type="file" id="disk1" accept=".atr,application/octet-stream" />
      <span>Load ATR <i id="diskStatus" class="fa-solid fa-circle-xmark status-icon"></i></span>
    </label>
    <div class="iconControls">
      <button id="btnStart" title="Start/Pause"><i class="fa-solid fa-play"></i></button>
      <button id="btnReset" disabled title="Reset"><i class="fa-solid fa-rotate-right"></i></button>
      <button id="btnFullscreen" title="Fullscreen"><i class="fa-solid fa-expand"></i></button>
      <button id="btnTurbo" class="toggle-btn" title="CPU Turbo">
        <span class="fa-layers fa-fw turbo-stack">
          <i class="fa-solid fa-microchip"></i>
          <i class="fa-solid fa-forward-fast turbo-badge"></i>
        </span>
      </button>
      <button id="btnSioTurbo" class="toggle-btn active" title="SIO Turbo">
        <span class="fa-layers fa-fw turbo-stack">
          <i class="fa-solid fa-floppy-disk"></i>
          <i class="fa-solid fa-forward-fast turbo-badge"></i>
        </span>
      </button>
      <button id="btnAudio" class="toggle-btn active" title="Audio">
        <i class="fa-solid fa-volume-high audio-on"></i>
        <i class="fa-solid fa-volume-xmark audio-off"></i>
      </button>
      <button id="btnJoystick" class="toggle-btn" title="Joystick panel">
        <span class="fa-layers fa-fw joystick-stack">
          <i class="fa-solid fa-gamepad"></i>
          <i class="fa-solid fa-slash joystick-off-mark"></i>
        </span>
      </button>
      <button id="btnKeyboard" class="toggle-btn active" title="Keyboard panel">
        <span class="fa-layers fa-fw keyboard-stack">
          <i class="fa-solid fa-keyboard"></i>
          <i class="fa-solid fa-slash keyboard-off-mark"></i>
        </span>
      </button>
      <button id="btnOptionOnStart" class="toggle-btn" title="OPTION on boot (BASIC off)">
        <i class="fa-solid fa-hand-point-down"></i>
      </button>
    </div>
  </div>
</header>

<main class="layout">
  <section class="screenPanel">
    <div class="screenViewport">
      <canvas id="screen" width="336" height="240"></canvas>
    </div>
    <section id="joystickPanel" class="joystickPanel" hidden>
      <div class="joystickPanelInner">
        <div class="cx40" id="joystickArea">
          <div class="cx40-base">
            <div class="cx40-cable"></div>
            <div class="cx40-fire-housing">
              <button type="button" class="cx40-fire-btn" id="fireButton"></button>
            </div>
            <div class="cx40-markings-ring">
              <div class="cx40-arrow cx40-arrow-up"></div>
              <div class="cx40-arrow cx40-arrow-down"></div>
              <div class="cx40-arrow cx40-arrow-left"></div>
              <div class="cx40-arrow cx40-arrow-right"></div>
            </div>
            <div class="cx40-top-label">TOP</div>
            <div class="cx40-boot">
              <div class="cx40-glow up" id="glowUp"></div>
              <div class="cx40-glow down" id="glowDown"></div>
              <div class="cx40-glow left" id="glowLeft"></div>
              <div class="cx40-glow right" id="glowRight"></div>
              <div class="cx40-stick-area" id="joystickStick">
                <div class="cx40-stick-hex"></div>
                <div class="cx40-stick-shaft"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </section>
  <section id="keyboardPanel" class="keyboardPanel">
    <div id="atariKeyboard" class="atariKeyboard" role="group">
      <div class="atari">
        <div class="case-keyboard">
          <div class="deck">
            <div class="main">
              <div class="row">
                <button type="button" class="kbKey key small" style="--w:1.15;" data-key="Escape" data-code="Escape">ESC</button>
                <button type="button" class="kbKey key" data-key="1" data-code="Digit1"><span class="leg"><span class="top">!</span><span class="mainlbl">1</span></span></button>
                <button type="button" class="kbKey key" data-key="2" data-code="Digit2"><span class="leg"><span class="top">"</span><span class="mainlbl">2</span></span></button>
                <button type="button" class="kbKey key" data-key="3" data-code="Digit3"><span class="leg"><span class="top">#</span><span class="mainlbl">3</span></span></button>
                <button type="button" class="kbKey key" data-key="4" data-code="Digit4"><span class="leg"><span class="top">$</span><span class="mainlbl">4</span></span></button>
                <button type="button" class="kbKey key" data-key="5" data-code="Digit5"><span class="leg"><span class="top">%</span><span class="mainlbl">5</span></span></button>
                <button type="button" class="kbKey key" data-key="6" data-code="Digit6"><span class="leg"><span class="top">&amp;</span><span class="mainlbl">6</span></span></button>
                <button type="button" class="kbKey key" data-key="7" data-code="Digit7"><span class="leg"><span class="top">'</span><span class="mainlbl">7</span></span></button>
                <button type="button" class="kbKey key" data-key="8" data-code="Digit8"><span class="leg"><span class="top">@</span><span class="mainlbl">8</span></span></button>
                <button type="button" class="kbKey key" data-key="9" data-code="Digit9"><span class="leg"><span class="top">(</span><span class="mainlbl">9</span></span></button>
                <button type="button" class="kbKey key" data-key="0" data-code="Digit0"><span class="leg"><span class="top">)</span><span class="mainlbl">0</span></span></button>
                <button type="button" class="kbKey key small" data-key="[" data-code="BracketLeft"><span class="leg"><span class="top">CLEAR</span><span class="mainlbl">&lt;</span></span></button>
                <button type="button" class="kbKey key small" data-key="]" data-code="BracketRight"><span class="leg"><span class="top">INSERT</span><span class="mainlbl">&gt;</span></span></button>
                <button type="button" class="kbKey key small" style="--w:1.55;" data-key="Backspace" data-code="Backspace"><span class="leg"><span class="top">DELETE</span><span class="mainlbl">BACK S</span></span></button>
                <button type="button" class="kbKey key small" style="--w:1.15;" data-key="F8" data-code="F8" data-sdl="289">BREAK</button>
              </div>
              <div class="row">
                <button type="button" class="kbKey key small" style="--w:1.55;" data-key="Tab" data-code="Tab"><span class="leg"><span class="top">CLR</span><span class="mainlbl">TAB</span></span></button>
                <button type="button" class="kbKey key" data-key="q" data-code="KeyQ">Q</button>
                <button type="button" class="kbKey key" data-key="w" data-code="KeyW">W</button>
                <button type="button" class="kbKey key" data-key="e" data-code="KeyE">E</button>
                <button type="button" class="kbKey key" data-key="r" data-code="KeyR">R</button>
                <button type="button" class="kbKey key" data-key="t" data-code="KeyT">T</button>
                <button type="button" class="kbKey key" data-key="y" data-code="KeyY">Y</button>
                <button type="button" class="kbKey key" data-key="u" data-code="KeyU">U</button>
                <button type="button" class="kbKey key" data-key="i" data-code="KeyI">I</button>
                <button type="button" class="kbKey key" data-key="o" data-code="KeyO">O</button>
                <button type="button" class="kbKey key" data-key="p" data-code="KeyP">P</button>
                <button type="button" class="kbKey key small" data-key="-" data-code="Minus"><span class="leg"><span class="top">&#x2191;</span><span class="mainlbl">-</span></span></button>
                <button type="button" class="kbKey key small" data-key="=" data-code="Equal"><span class="leg"><span class="top">&#x2193;</span><span class="mainlbl">=</span></span></button>
                <button type="button" class="kbKey key wide small" style="--w:1.75;" data-key="Enter" data-code="Enter">RETURN</button>
              </div>
              <div class="row">
                <button type="button" class="kbKey key wide small" style="--w:1.75;" data-modifier="ctrl">CTRL</button>
                <button type="button" class="kbKey key" data-key="a" data-code="KeyA">A</button>
                <button type="button" class="kbKey key" data-key="s" data-code="KeyS">S</button>
                <button type="button" class="kbKey key" data-key="d" data-code="KeyD">D</button>
                <button type="button" class="kbKey key" data-key="f" data-code="KeyF">F</button>
                <button type="button" class="kbKey key" data-key="g" data-code="KeyG">G</button>
                <button type="button" class="kbKey key" data-key="h" data-code="KeyH">H</button>
                <button type="button" class="kbKey key" data-key="j" data-code="KeyJ">J</button>
                <button type="button" class="kbKey key" data-key="k" data-code="KeyK">K</button>
                <button type="button" class="kbKey key" data-key="l" data-code="KeyL">L</button>
                <button type="button" class="kbKey key small" data-key=";" data-code="Semicolon"><span class="leg"><span class="top">:</span><span class="mainlbl">;</span></span></button>
                <button type="button" class="kbKey key small" data-key="'" data-code="Quote"><span class="leg"><span class="top">\</span><span class="mainlbl">+</span></span></button>
                <button type="button" class="kbKey key small" data-key="\\" data-code="Backslash" data-sdl="92"><span class="leg"><span class="top">^</span><span class="mainlbl">*</span></span></button>
                <button type="button" class="kbKey key wide small" style="--w:1.55;" data-key="CapsLock" data-code="CapsLock" data-sdl="301">CAPS</button>
              </div>
              <div class="row">
                <button type="button" class="kbKey key wide small" style="--w:2.1;" data-modifier="shift">SHIFT</button>
                <button type="button" class="kbKey key" data-key="z" data-code="KeyZ">Z</button>
                <button type="button" class="kbKey key" data-key="x" data-code="KeyX">X</button>
                <button type="button" class="kbKey key" data-key="c" data-code="KeyC">C</button>
                <button type="button" class="kbKey key" data-key="v" data-code="KeyV">V</button>
                <button type="button" class="kbKey key" data-key="b" data-code="KeyB">B</button>
                <button type="button" class="kbKey key" data-key="n" data-code="KeyN">N</button>
                <button type="button" class="kbKey key" data-key="m" data-code="KeyM">M</button>
                <button type="button" class="kbKey key small" data-key="," data-code="Comma"><span class="leg"><span class="top">[</span><span class="mainlbl">,</span></span></button>
                <button type="button" class="kbKey key small" data-key="." data-code="Period"><span class="leg"><span class="top">]</span><span class="mainlbl">.</span></span></button>
                <button type="button" class="kbKey key small" data-key="/" data-code="Slash"><span class="leg"><span class="top">?</span><span class="mainlbl">/</span></span></button>
                <button type="button" class="kbKey key wide small" style="--w:2.1;" data-modifier="shift">SHIFT</button>
                <button type="button" class="kbKey key small" data-key="F6" data-code="F6" data-sdl="287">&#x25E2;</button>
              </div>
              <div class="row">
                <div class="spacer" style="--w:2.1;"></div>
                <button type="button" class="kbKey key space small" style="--w:9.8;" data-key=" " data-code="Space"></button>
                <div class="spacer" style="--w:2.1;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="case-side">
          <div class="side-keys">
            <button type="button" class="kbKey side-key" data-key="F5" data-code="F5" data-sdl="286"></button>
            <button type="button" class="kbKey side-key" data-key="F2" data-code="F2" data-sdl="283"></button>
            <button type="button" class="kbKey side-key" data-key="F3" data-code="F3" data-sdl="284"></button>
            <button type="button" class="kbKey side-key" data-key="F4" data-code="F4" data-sdl="285"></button>
            <button type="button" class="kbKey side-key" data-key="F1" data-code="F1" data-sdl="282"></button>
          </div>
          <div class="strip">
            <div class="strip-label">RESET</div>
            <div class="strip-label">OPTION</div>
            <div class="strip-label">SELECT</div>
            <div class="strip-label">START</div>
            <div class="strip-label">HELP</div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Load jsA8E emulator modules (order matters) -->
<script src="A8E/jsA8E/js/shared/util.js"></script>
<script src="A8E/jsA8E/js/render/palette.js"></script>
<script src="A8E/jsA8E/js/render/software.js"></script>
<script src="A8E/jsA8E/js/core/cpu_tables.js"></script>
<script src="A8E/jsA8E/js/core/cpu.js"></script>
<script src="A8E/jsA8E/js/render/gl.js"></script>
<script src="A8E/jsA8E/js/core/pokey_sio.js"></script>
<script src="A8E/jsA8E/js/core/pokey.js"></script>
<script src="A8E/jsA8E/js/audio/runtime.js"></script>
<script src="A8E/jsA8E/js/core/keys.js"></script>
<script src="A8E/jsA8E/js/core/input.js"></script>
<script src="A8E/jsA8E/js/core/hw.js"></script>
<script src="A8E/jsA8E/js/core/state.js"></script>
<script src="A8E/jsA8E/js/core/memory.js"></script>
<script src="A8E/jsA8E/js/core/io.js"></script>
<script src="A8E/jsA8E/js/core/playfield.js"></script>
<script src="A8E/jsA8E/js/core/antic.js"></script>
<script src="A8E/jsA8E/js/core/gtia.js"></script>
<script src="A8E/jsA8E/js/core/atari.js"></script>
<script src="A8E/jsA8E/js/app/ui.js"></script>
<script src="A8E/jsA8E/js/app/version.js"></script>

<script>
// =============================================================================
// Castle Quest - Self-booting ATR builder + Auto-play launcher
// =============================================================================
"use strict";

// --- Monkey-patch A8EApp.create to capture the app instance ---
var _cqApp = null;
(function() {
  var origCreate = window.A8EApp.create;
  window.A8EApp.create = function(opts) {
    var app = origCreate.call(this, opts);
    _cqApp = app;
    return app;
  };
})();

// --- Embedded Altirra OS ROM (base64-encoded, 16384 bytes) ---
// Altirra OS 3.11 - Copyright (C) 2008-2018 Avery Lee
// Copying and distribution permitted without royalty. Offered as-is, without warranty.
var ALTIRRA_OS_B64 = "AAABARMCQ1gAAAAA5hTQCOZN5hPQAuYSov6pAKRNEAaGTaL2pROGToVPTcUCJU6NF9CtGALQCK0ZAvAQzhkCzhgC0AitGQLQAyBWwKVC8AloqGiqaEBsJgKpBLo9BAHQ71itMQKNA9StMAKNAtStLwKNANSt9AKNCdSt8wKNAdStbwKNG9CiCI4f0L3AAkVPJU6dEtDKEPOiAyBFwdADIELBogkYIEXBsAfwAqn/nSUCysrgBbDtrQ/SKQTQEc4rAtAZrQnSjfwCrdoCTNnArfEC8APO8QKpAI0rAq0A06opD414Ao16AopKSqpKSo15Ao17AkpKqCkBjX4CmEqNfwKKKQGNfAKKSikBjX0CogO9ANKdcAKddAK9fAKdgALKEO6iAb0Q0J2EAp2GAsoQ9I0L0q0M1I00Aq0N1I01AmwkAmwoAr0XAtAK3RgC0AKKYN4YAt4XAtADvRgCYAqMLQKoigh47grUonwIKAgo7AvU8AuZFwKtLQKZFgIoYAgo8PGpQI0O1K0T0I36A2AsD9QQA2wAAkjYikiYSI0P1GwiAthsFgIt/9HwTY2MAopIrYwCbDgCqe8gUsJsDAIsDtLQQWwOAqn+IFLCbBACqf0gUsJsEgKp+yBSwmwUAkipICwO0tANqd+NDtKlEI0O0mwKAq1JAtCuqRAsDtLwt0okENC6rQ7SSpC8SpDBSpDGLA7SUCEQJywC0zAqLAPTMCtojYwCaEgpEPAHrYwCSGwGAq2MAkCpvyBSwmwIAql/IFLCbDYCrQDTbAICrQHTbAQCjQ7SpRCNDtJgqYuNOAKpwo05AqkBjUgCjf/RrAPYwIDQCqwL2MCR0AMgGditSAIK0OONSAKN/9FgjYwCSf8YaQEtjAKuSAKNSAKN/9GKSCAI2GiNSAKN/9FoqmhArUcC0AiNSAKN/9EYYKkAOCqw8ixHAvD4jUgCjf/RSCAF2GiQ66kAjUgCjf/RYKAAEAqgAhAGoAQQAqAGjEoCjUsCqQA4KrAbLEcC8PiNSAKN/9GlLyAWw5DrogCOSAKO/9FgoILQ86xKArkO2Ei5DdhIrUsCoJJgoAgQwKAKELxImEiKoiHdGgPwF8rKyhD26OjovBoD8BDgJND0aGip/zhgaKho6DhgnRoDaJ0bA2idHAMKGGCMSgKNSwKi6akDqNAE4ADwI4Y2hTegErE2qsixNs1LAtDo7EoC0OOGSoVLoBCxSsgRSvACOGCgErFKqsixSpE2iIqRNhhgjOwCje0CCKLpqQOGSoVLoBKxSqrIsUrQ8uAA0O6t7QKRSqqIrewCkUqGS4VKoBOpAJFKiJFKIC3EkAqlSqRLIGXDKDhgKLAKoBCpAKqRSsiRSiAWxKAPqQCRSqARGHFKiBD7aQCgD5FKGGCgEbFKqoixShht5wKN5wKKbegCjegCYKVKGGkLqqVLaQBIikhgrvsDrfwDhkqFSwVK8C2gERixSohxSoiIcUqIEPtpAKAP0UrQFiAtxLARIBbEoBOxSqrIsUrQz+AA0Mtgok8g8cSpAI0KA40LA40JA6nqjQQDqQKNBQOpBI0IA6lAjQMDIFnkEBHAitABYMCA8PuiTiDxxEx8xK3nAqpqim3qAqqt6AJt6wLN5gKQCdDd7OUCsALQ1q3nAqpqimkAjdECregCaQCN0gKt7AKNAAM4IA7FsLdMfMSpT40AA44KA44LA6lAjQIDqQGNAQOpAI0DA0xZ5AipgI3TAqlNjc8CqcWN0AKpJo0CA6IAjgoDjgkDjgQDyoY9qQSNBQOpgI0IAyBnxbALrNECrdICKCCrw2BoYKY9EAypQI0DAyBZ5DAKogC9AATohj0YYDhgqQCN1AIgZcaNMwIgZcaNRQIgfsVMbMWuMwK8jcW5ncVIuZnFSGAAAAEBAQEBAQICAAOg3Q4sxcXGxiBlxoU2IGXGhTetMwLJCvARCqoYvdECZTaFNr3SAmU3hTepAI0zAs5FAtALIGXGrDMC7jMCkTbORQLQ8GCtMwJKrtECyQLQA67TAoZKyQNmSyBlxqixNhhlSpE2JEsQCMixNm3SApE2zkUC0ORgIGXGhUogZcYYbdECpEqt0gJxNpE2zkUCzkUC0ONgIGXGjckCIGXGjcoCrjMC0A6pAI3JAo3KAhhoaKABYMrw9xityQJt0QKNyQKtygJt0gKNygJMRsYgbcaQAmhoYGzPAv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAGBgYGAAYAABmZmYAAAAAAGb/Zmb/ZgAYPmA8BnwYAABmbBgwZkYAHDYcOG9mOwAAGBgYAAAAAAAOHBgYHA4AAHA4GBg4cAAAZjz/PGYAAAAYGH4YGAAAAAAAAAAYGDAAAAB+AAAAAAAAAAAAGBgAAAYMGDBgQAAAPGZudmY8AAAYOBgYGH4AADxmDBgwfgAAfgwYDGY8AAAMHDxsfgwAAH5gfAZmPAAAPGB8ZmY8AAB+BgwYMDAAADxmPGZmPAAAPGY+Bgw4AAAAGBgAGBgAAAAYGAAYGDAGDBgwGAwGAAAAfgAAfgAAYDAYDBgwYAAAPGYMGAAYAAA8Zm5uYD4AABg8ZmZ+ZgAAfGZ8ZmZ8AAA8ZmBgZjwAAHhsZmZseAAAfmB8YGB+AAB+YHxgYGAAAD5gYG5mPgAAZmZ+ZmZmAAB+GBgYGH4AAAYGBgZmPAAAZmx4eGxmAABgYGBgYH4AAGN3f2tjYwAAZnZ+fm5mAAA8ZmZmZjwAAHxmZnxgYAAAPGZmZmw2AAB8ZmZ8bGYAADxgPAYGPAAAfhgYGBgYAABmZmZmZn4AAGZmZmY8GAAAY2Nrf3djAABmZjw8ZmYAAGZmPBgYGAAAfgwYMGB+AAAeGBgYGB4AAEBgMBgMBgAAeBgYGBh4AAAIHDZjAAAAAAAAAAAA/wAMGDwGPmY+ADAYAGZmZj4ANmwAdnZ+bgAMGH5gfGB+AAAAPGBgPBgwPGYAPGZmPAAwGAA8ZmY8ADAYADgYGDwA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VoApVVVVVVX//1VVVVaAqVVVVVVV//9VVVVWoKlVVVVVVf//VVVVVqCpVVVVVVX//1VVVVagqVVVVVVV//9VVVVWoKVVVVVVVf//VVVVVaClVVVVVVX//1VVVVWgpVVX///////////VoKVVV///////////1aClVVf//////////9WgpVVVVVVV//9VVVVVoKVVVVVVVf//VVVVVaClVVVVVVX//1VVVVWgqVVVVVVV//9VVVVWoKlVVVVVVf//VVVVVqCpVVVVVVX//1VVVVagqVVVVVVV//9VVVVWoKlVVVVVVf//VVVVVqCpVVVVVVX//1VVVVagKVVVVVVV//9VVVVWgClVVVVVVVVVVVVVVoApVVVVVVVVVVVVVVaAKVVVVVVVVVVVVVVWgCpVVVVVVVVVVVVVWoAKVVVVVVVVVVVVVVoACqqqqqqqqqqqqqqqAAqqqqqqqqqqqqqqqgAKqqqqqqqqqqqqqqoAAqqqqqqqqqqqqqqoAAAAAAqqqqqqqgAAAACHUp5So1IUMAAAAgAIDAIUUD0B/3BwcHDw8PDw8PDw8E4AMg4ODg4ODo4ODg4ODg4Ojg4ODg4ODg6ODg4ODg4ODo4ODg4ODg4OjvBwTwAgDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw9wDw8PDw8PDw8PDw8PDw8PD0EUMP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zMuNDEA//8AIKHbqX+F1IXqotUgRtqF5oXppPKx88kr8AbJLdADZunIhOipMCCl27HzyS7QEMhm5uboqTDR89AFxtTI0PeiAbHzyUXwVcjJLvAoSTDJCrAq4AawFSTqEAnG6hXUldTo0Ajm6goKCgqV1CTmMALm1ExA2KXm0ARm5tDFiMTo8BqE8ibpZtSwD6IERtVm1mbXZthm2crQ80wA3GDE6PD7hPKiAMix88kr8AXJLdACysiG5yCx28iwyqogsduwBch9OdqqivC8Recm52XU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3PEgC/LOQQLwIu4KA9AD7gsDIFPkEOvAitABYK0B00mAjQHTMNcgAlBMhPEg+fGw6yAx8akBhQlgqYCFPiB95CB65DAkogIg3PEgC/IgeuQwF85BAtDzIPnxIDTxqQCN6QOpAoUJbAoAqQCN6QMgbu1MIPKg/LkEA5lEAcjQ94UWrUIChRWtBASVAK0FBJUBYK1CAhhpBoUErUMCaQCFBWwEAKB/uQAEkRWIEPilFUmAhRUwAuYWYKL1iki9O/EguvpoqujQ82BCT09UIEVSUk9SmwARIjNEVWZ3iJmqu8zd7v8AVar/AP9AgHBwgKDgYFBQUFCggGBQ/P3+/v379/Dh4eHh+/3w4QIGBwgJCgsdP3+//wQFHD4BAQABAgIDAwQEBAQBAAQEDBgwYMABAAABAgIDAwQCAgIBAQMDChQoUKBAAAAAAAEAAAACAwIDAgMBAQEAAAMC/w8DAf/wwID//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6kMhSqpAIUrrS8CKdyNLwKNANSiC6kAlVSdkALK0PiGe6UrKQ+FV6q9cfJNbwIpwE1vAo1vAslAivAGpSqQAinvCgqFaLyB8r6R8goQA76m8oZppWqmVxh9YfKwCYrwAyDu86CTYIVZvFHyhFi9cfKmWSkw8AOgAMqEcI7mAoZxjjECySCp+JACqfXlaSRoUALpBqABzG4CZXCN5QKFcI0wAuQPkLfQBMUOkLHO5QKmasqOlQKpYI2UAgh4CgUQhRCNDtIooBiMvwKgBbm69ZnDAojQ94zwAqlwogMghPWlV8kL0AWpBo3IAiA69YR+ILT1JGhQEqIEjr8CIED5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";

// --- Embedded Altirra BASIC ROM (base64-encoded, 8192 bytes) ---
// Altirra BASIC 1.58 - Copyright (C) 2008-2022 Avery Lee
// Copying and distribution permitted without royalty. Offered as-is, without warranty.
var ALTIRRA_BASIC_B64 = "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";

// --- Embedded Castle Quest .bas file (base64-encoded, 8711 bytes) ---
var QUEST_BAS_B64 = "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";

// --- Decode base64 to Uint8Array ---
function base64ToUint8Array(b64) {
  var bin = atob(b64);
  var arr = new Uint8Array(bin.length);
  for (var i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
  return arr;
}

// =============================================================================
// Build a self-booting ATR disk image with a 6502 boot loader
// that loads the Castle Quest BASIC program directly into RAM.
//
// Disk layout:
//   Sectors 1-2:  Boot loader (loaded at $3000 by Atari OS)
//   Sectors 3-71: Castle Quest .bas file data (69 sectors)
//   Sectors 72+:  Unused
//
// Boot sequence:
//   1. Atari OS reads sectors 1-2 into $3000 and calls INIT at $3006
//   2. Boot loader reads sectors 3-71 via SIO into $06F2
//      (14-byte .bas header lands at $06F2-$06FF, program data at $0700 = LOMEM)
//   3. Boot loader sets BASIC zero-page pointers ($80-$8F)
//   4. Boot loader sets WARMST ($0008) = $FF
//   5. Returns to OS  OS starts BASIC  BASIC warm starts with program loaded
//   6. User types RUN (or we auto-type it via JavaScript)
// =============================================================================
function buildBootableATR(basBytes) {
  var SECTOR_SIZE = 128;
  var TOTAL_SECTORS = 720; // standard single-density
  var ATR_HEADER = 16;
  var BOOT_SECTORS = 2;
  var dataSectors = Math.ceil(basBytes.length / SECTOR_SIZE); // 69 for 8711 bytes
  var FIRST_DATA_SECTOR = BOOT_SECTORS + 1; // sector 3

  var diskBytes = TOTAL_SECTORS * SECTOR_SIZE;
  var atr = new Uint8Array(ATR_HEADER + diskBytes);

  // ATR header: magic $9602, size in 16-byte paragraphs, sector size
  var para = diskBytes >> 4;
  atr[0] = 0x96; atr[1] = 0x02;
  atr[2] = para & 0xFF; atr[3] = (para >> 8) & 0xFF;
  atr[4] = SECTOR_SIZE & 0xFF; atr[5] = (SECTOR_SIZE >> 8) & 0xFF;
  atr[6] = (para >> 16) & 0xFF;

  function secOff(n) { return ATR_HEADER + (n - 1) * SECTOR_SIZE; }

  // --- Parse .bas header to get BASIC pointer offsets ---
  // Header: 7 x 16-bit LE values (relative to LOMEM)
  //   [0]=LOMEM(0), [1]=VNTP, [2]=VNTD, [3]=VVTP,
  //   [4]=STMTAB, [5]=STARP, [6]=RUNSTK
  var LOMEM_BASE = 0x0700;
  var hdr = [];
  for (var h = 0; h < 7; h++) {
    hdr.push((basBytes[h * 2] | (basBytes[h * 2 + 1] << 8)));
  }
  var pLOMEM  = LOMEM_BASE;
  var pVNTP   = LOMEM_BASE + hdr[1];
  var pVNTD   = LOMEM_BASE + hdr[2];
  var pVVTP   = LOMEM_BASE + hdr[3];
  var pSTMTAB = LOMEM_BASE + hdr[4];
  var pSTARP  = LOMEM_BASE + hdr[5];

  // --- Build 6502 boot loader machine code ---
  var code = [];
  function emit() { for (var i = 0; i < arguments.length; i++) code.push(arguments[i] & 0xFF); }

  // Boot sector header (6 bytes at $3000)
  emit(0x00);       // BFLAG: INIT only (no RUN vector)
  emit(BOOT_SECTORS); // BRCNT: 2 boot sectors
  emit(0x00, 0x30); // BOOTAD: load at $3000
  emit(0x06, 0x30); // BWTINI: init routine at $3006

  // === INIT routine ($3006) ===

  // Set up SIO Device Control Block for disk read
  emit(0xA9, 0x31, 0x8D, 0x00, 0x03); // LDA #$31; STA $0300 (DDEVIC=disk)
  emit(0xA9, 0x01, 0x8D, 0x01, 0x03); // LDA #$01; STA $0301 (DUNIT=1)
  emit(0xA9, 0x52, 0x8D, 0x02, 0x03); // LDA #$52; STA $0302 (DCOMND=Read)
  emit(0xA9, 0x40, 0x8D, 0x03, 0x03); // LDA #$40; STA $0303 (DSTATS=recv)
  emit(0xA9, 0x80, 0x8D, 0x08, 0x03); // LDA #$80; STA $0308 (DBYTLO=128)
  emit(0xA9, 0x00, 0x8D, 0x09, 0x03); // LDA #$00; STA $0309 (DBYTHI=0)
  emit(0xA9, 0x07, 0x8D, 0x06, 0x03); // LDA #$07; STA $0306 (DTIMLO=7sec)

  // Buffer starts at $06F2 = LOMEM - 14 (header before program data)
  var readTarget = LOMEM_BASE - 14; // $06F2
  emit(0xA9, readTarget & 0xFF, 0x8D, 0x04, 0x03);       // LDA #$F2; STA DBUFLO
  emit(0xA9, (readTarget >> 8) & 0xFF, 0x8D, 0x05, 0x03); // LDA #$06; STA DBUFHI

  // Starting sector
  emit(0xA9, FIRST_DATA_SECTOR & 0xFF, 0x8D, 0x0A, 0x03);       // STA DAUX1
  emit(0xA9, (FIRST_DATA_SECTOR >> 8) & 0xFF, 0x8D, 0x0B, 0x03); // STA DAUX2

  // Sector count
  emit(0xA2, dataSectors & 0xFF); // LDX #dataSectors

  // --- Read loop ---
  var loopStart = code.length;

  emit(0x8A);                   // TXA
  emit(0x48);                   // PHA (save counter)
  emit(0x20, 0x59, 0xE4);      // JSR $E459 (SIOV)

  // Advance buffer pointer by 128
  emit(0x18);                   // CLC
  emit(0xAD, 0x04, 0x03);      // LDA $0304
  emit(0x69, 0x80);             // ADC #$80
  emit(0x8D, 0x04, 0x03);      // STA $0304
  emit(0x90, 0x03);             // BCC +3 (skip INC)
  emit(0xEE, 0x05, 0x03);      // INC $0305

  // Advance sector number
  emit(0xEE, 0x0A, 0x03);      // INC $030A
  emit(0xD0, 0x03);             // BNE +3 (skip INC)
  emit(0xEE, 0x0B, 0x03);      // INC $030B

  // Decrement counter and loop
  emit(0x68);                   // PLA
  emit(0xAA);                   // TAX
  emit(0xCA);                   // DEX
  var bnePos = code.length;
  emit(0xD0, 0x00);             // BNE loop (placeholder offset)
  // Fix BNE offset: target=loopStart, PC after BNE = bnePos+2
  code[bnePos + 1] = (loopStart - (bnePos + 2)) & 0xFF;

  // --- Set BASIC zero-page pointers ---
  // $80-81: LOMEM
  emit(0xA9, pLOMEM & 0xFF,  0x85, 0x80);
  emit(0xA9, (pLOMEM >> 8) & 0xFF,  0x85, 0x81);
  // $82-83: VNTP
  emit(0xA9, pVNTP & 0xFF,   0x85, 0x82);
  emit(0xA9, (pVNTP >> 8) & 0xFF,   0x85, 0x83);
  // $84-85: VNTD
  emit(0xA9, pVNTD & 0xFF,   0x85, 0x84);
  emit(0xA9, (pVNTD >> 8) & 0xFF,   0x85, 0x85);
  // $86-87: VVTP
  emit(0xA9, pVVTP & 0xFF,   0x85, 0x86);
  emit(0xA9, (pVVTP >> 8) & 0xFF,   0x85, 0x87);
  // $88-89: STMTAB
  emit(0xA9, pSTMTAB & 0xFF, 0x85, 0x88);
  emit(0xA9, (pSTMTAB >> 8) & 0xFF, 0x85, 0x89);
  // $8A-8B: STMCUR (set to STMTAB for clean state)
  emit(0xA9, pSTMTAB & 0xFF, 0x85, 0x8A);
  emit(0xA9, (pSTMTAB >> 8) & 0xFF, 0x85, 0x8B);
  // $8C-8D: STARP
  emit(0xA9, pSTARP & 0xFF,  0x85, 0x8C);
  emit(0xA9, (pSTARP >> 8) & 0xFF,  0x85, 0x8D);
  // $8E-8F: RUNSTK (= STARP initially)
  emit(0xA9, pSTARP & 0xFF,  0x85, 0x8E);
  emit(0xA9, (pSTARP >> 8) & 0xFF,  0x85, 0x8F);

  // Set WARMST flag at $0008 = non-zero (triggers BASIC warm start)
  emit(0xA9, 0xFF);             // LDA #$FF
  emit(0x85, 0x08);             // STA $08

  // Return to OS boot sequence
  emit(0x60);                   // RTS

  // --- Write boot loader to sectors 1-2 ---
  var bootBytes = new Uint8Array(code);
  var s1 = secOff(1);
  atr.set(bootBytes.subarray(0, Math.min(128, bootBytes.length)), s1);
  if (bootBytes.length > 128) {
    atr.set(bootBytes.subarray(128, Math.min(256, bootBytes.length)), secOff(2));
  }

  // --- Write .bas file data to sectors 3+ ---
  for (var i = 0; i < dataSectors; i++) {
    var start = i * SECTOR_SIZE;
    var end = Math.min(start + SECTOR_SIZE, basBytes.length);
    var chunk = basBytes.subarray(start, end);
    atr.set(chunk, secOff(FIRST_DATA_SECTOR + i));
  }

  return atr;
}

// =============================================================================
// Keyboard simulation - type characters into the emulator
// =============================================================================
function sendKeyToApp(app, key, code, shiftKey) {
  var ev = {
    key: key,
    code: code || "",
    ctrlKey: false,
    shiftKey: !!shiftKey
  };
  app.onKeyDown(ev);
  setTimeout(function() { app.onKeyUp(ev); }, 60);
}

function typeStringIntoEmulator(app, str, callback) {
  var i = 0;
  function next() {
    if (i >= str.length) {
      if (callback) setTimeout(callback, 150);
      return;
    }
    var ch = str.charAt(i++);
    if (ch === "\n") {
      sendKeyToApp(app, "Enter", "Enter", false);
    } else if (ch >= "A" && ch <= "Z") {
      sendKeyToApp(app, ch.toLowerCase(), "Key" + ch, true);
    } else if (ch >= "a" && ch <= "z") {
      sendKeyToApp(app, ch, "Key" + ch.toUpperCase(), false);
    } else if (ch >= "0" && ch <= "9") {
      sendKeyToApp(app, ch, "Digit" + ch, false);
    } else if (ch === " ") {
      sendKeyToApp(app, " ", "Space", false);
    } else if (ch === '"') {
      // Atari: " is Shift+2 (but jsA8E maps browser Shift+Quote)
      sendKeyToApp(app, '"', "Digit2", true);
    }
    setTimeout(next, 120);
  }
  next();
}

// =============================================================================
// UI state management
// =============================================================================
var gameStatus = document.getElementById("gameStatus");
var btnPlay = document.getElementById("btnPlay");
var btnAutoRun = document.getElementById("btnAutoRun");
var btnInfo = document.getElementById("btnInfo");
var gameAtr = null;   // built ATR data
var gameStarted = false;

function setStatus(msg, color) {
  gameStatus.textContent = msg;
  gameStatus.style.color = color || "#ccc";
}

function updateDiskStatusIcon(loaded) {
  var ds = document.getElementById("diskStatus");
  if (loaded) {
    ds.classList.remove("fa-circle-xmark");
    ds.classList.add("fa-circle-check");
  }
}

// Info panel toggle
btnInfo.addEventListener("click", function() {
  document.getElementById("infoPanel").classList.toggle("visible");
});

// Play button: start emulation
btnPlay.addEventListener("click", function() {
  if (!_cqApp || !_cqApp.isReady() || gameStarted) return;
  gameStarted = true;
  btnPlay.disabled = true;
  _cqApp.start();
  document.getElementById("screen").focus();
  setStatus("Booting Atari... game will load automatically.", "#88ff88");
  // Enable auto-run button after boot delay
  setTimeout(function() {
    btnAutoRun.disabled = false;
    setStatus("BASIC shows READY. Click 'Type RUN' or type RUN + RETURN yourself.", "#ffcc00");
  }, 5000);
});

// Auto-type RUN button
btnAutoRun.addEventListener("click", function() {
  if (!_cqApp) return;
  btnAutoRun.disabled = true;
  document.getElementById("screen").focus();
  setStatus("Typing RUN...", "#88ff88");
  typeStringIntoEmulator(_cqApp, "RUN\n", function() {
    setStatus("Game running! Use arrow keys to move, Left Alt for fire.", "#88ff88");
  });
});

// =============================================================================
// Main startup - replaces a8e.js
// =============================================================================
(function() {
  // Build the game ATR immediately
  var basBytes = base64ToUint8Array(QUEST_BAS_B64);
  gameAtr = buildBootableATR(basBytes);

  // Watch for ROMs to be loaded (by auto-fetch or manual file input)
  function checkReady() {
    if (!_cqApp) return false;
    if (_cqApp.isReady()) {
      btnPlay.disabled = false;
      setStatus("Ready! Click 'Play Game' to start.", "#88ff88");
      return true;
    }
    return false;
  }

  var readyInterval = null;

  async function main() {
    setStatus("Booting emulator...", "#aaa");

    // Boot the jsA8E UI (creates app, sets up file inputs, keyboard, etc.)
    await window.A8EUI.boot();

    if (!_cqApp) {
      setStatus("Error: emulator failed to initialize.", "#ff4444");
      return;
    }

    // Load the game ATR disk
    _cqApp.loadDisk1(gameAtr.buffer, "CASTLE_QUEST.ATR");
    updateDiskStatusIcon(true);

    // Load embedded Altirra replacement ROMs
    try {
      var osRomBytes = base64ToUint8Array(ALTIRRA_OS_B64);
      _cqApp.loadOsRom(osRomBytes.buffer);
      var romOsStatus = document.getElementById("romOsStatus");
      if (romOsStatus) { romOsStatus.classList.remove("fa-circle-xmark"); romOsStatus.classList.add("fa-circle-check"); }
    } catch(e) { console.error("OS ROM load error:", e); }

    try {
      var basicRomBytes = base64ToUint8Array(ALTIRRA_BASIC_B64);
      _cqApp.loadBasicRom(basicRomBytes.buffer);
      var romBasicStatus = document.getElementById("romBasicStatus");
      if (romBasicStatus) { romBasicStatus.classList.remove("fa-circle-xmark"); romBasicStatus.classList.add("fa-circle-check"); }
    } catch(e) { console.error("BASIC ROM load error:", e); }

    // Check if ready
    if (!checkReady()) {
      setStatus("ROM loading failed. Use the ROM buttons above to load manually.", "#ff4444");
      readyInterval = setInterval(function() {
        if (checkReady() && readyInterval) {
          clearInterval(readyInterval);
          readyInterval = null;
        }
      }, 500);
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", function() {
      main().catch(function(e) { console.error("Boot error:", e); });
    });
  } else {
    main().catch(function(e) { console.error("Boot error:", e); });
  }
})();
</script>
</body>
</html>
